@model Jingl.General.Model.Admin.ViewModel.RefundFormModel

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout_Adm.cshtml";
}
@*@using (Html.BeginForm("SetStatus", "AdmRefund", FormMethod.Post, new { Id = "formEditBilling" }))
{*@
<form id="FormRefund">
    <h2>Refund</h2>

    <div class="panel panel-inverse">
        <div class="panel-heading">
            <div class="panel-heading-btn">
                <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" data-click="panel-expand"><i class="fa fa-expand"></i></a>
                <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-success" data-click="panel-reload"><i class="fa fa-redo"></i></a>
                <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-warning" data-click="panel-collapse"><i class="fa fa-minus"></i></a>
                <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-danger" data-click="panel-remove"><i class="fa fa-times"></i></a>
            </div>
            <h4 class="panel-title">Refund</h4>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-4">
                    <div class="panel" style="border: 1px solid rgba(0,0,0,.1);border-radius:8px">
                        <div class="panel-heading">
                            <b>Filter data</b>
                        </div>
                        <div class="panel-body">                          

                            <div class="row">

                                <div class="col-12">

                                    <div class="form-group row">
                                        <label for="staticEmail" class="col-sm-2 col-form-label">Status</label>
                                        <div class="col-sm-10">
                                            @Html.DropDownListFor(model => model.FilterStatus, ViewBag.ListStatus as IEnumerable<SelectListItem>, "Pilih Status", new { Class = "form-control", Placeholder = "" })
                                        </div>
                                    </div>
                                </div>
                            </div>

                            @*<div class="row">
                        <div class="col-4">
                            <button id="btnStatus" class="btn btn-success" type="submit">Set Status</button>

                        </div>
                    </div>*@

                        </div>
                    </div>
                </div>
                <div class="col-5">
                    <div class="panel" style="border: 1px solid rgba(0,0,0,.1);border-radius:8px">
                        <div class="panel-heading">
                            <b>Form Update Status</b>
                        </div>
                        <div class="panel-body">
                            <div class="row">

                                <div class="col-12">
                                    @*<div class="form-group row">
                                <label for="staticEmail" class="col-sm-2 col-form-label">Period</label>
                                <div class="col-sm-10">
                                    <select class="selectpicker">
                                        <option value="M2019-05"> M2019-05 </option>
                                        <option value="M2019-06"> M2019-06</option>
                                        <option value="M2019-07"> M2019-07 </option>
                                        <option value="M2019-08"> M2019-08 </option>
                                        <option value="M2019-09"> M2019-09 </option>
                                        <option value="M2019-10"> M2019-10 </option>
                                        <option value="M2019-11"> M2019-11 </option>
                                        <option value="M2019-12"> M2019-12 </option>

                                    </select>
                                </div>
                            </div>*@

                                    <div class="form-group row">
                                        <label for="staticEmail" class="col-sm-2 col-form-label">Status</label>
                                        <div class="col-sm-10">
                                            @Html.DropDownListFor(model => model.Status, ViewBag.ListStatus as IEnumerable<SelectListItem>, "Pilih Status", new { Class = "form-control", Placeholder = "" ,required="true"})
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-4">
                                    <button id="btnStatus" class="btn btn-success" type="submit">Update</button>

                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <table class="table table-striped table-bordered" id="data-table-buttons" style="width:100%">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" id="select-all" />
                        </th>
                        <th>
                            Customer Id
                        </th>
                        <th>
                            Customer Name

                        </th>
                        <th>
                            Clearing Code

                        </th>
                        <th>
                            Bank

                        </th>
                        <th>
                            Account Name

                        </th>
                        <th>
                            Request Date

                        </th>
                        <th>
                            Amount

                        </th>
                        <th>
                            Paid Date

                        </th>
                        <th>
                            Status
                            @Html.DisplayNameFor(model => model.Status)
                        </th>

                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.ListRefundModel)
                    {
                    <tr>
                        <td>
                            <input type="checkbox" name="SelectedRefund" class="rowchk" value="@item.Id" />
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.UserCode)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.CustomerName)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.ClearingCode)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.BankName)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.AccountNumber)
                        </td>
                        <td>
                            @{
                                if (item.RequestDate.HasValue)
                                {
                                    @item.RequestDate.Value.ToString("dd-MM-yyyy")
                                }
                            }

                        </td>
                        <td>
                            <label class="amountlines">@item.Amount</label>
                        </td>
                        <td>
                            @*@Html.DisplayFor(modelItem => item.PaidDate)*@

                            @{
                                if (item.PaidDate.HasValue)
                                {
                                    @item.PaidDate.Value.ToString("dd-MM-yyyy")
                                }
                            }


                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.StatusNm)
                        </td>

                        @*<td>
            @Html.DisplayFor(modelItem => item.CreatedBy)
        </td>*@

                    </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
    </form>
    @*}*@
    @section scripts{

        <script type="text/javascript">
            $(document).ready(function () {
                App.init();
                //TableManageResponsive.init();

                var handleDataTableButtons = function () {
                    "use strict";

                    if ($('#data-table-buttons').length !== 0) {
                        $('#data-table-buttons').DataTable({
                            dom: 'Bfrtip',
                            buttons: [

                                { extend: 'csv', className: 'btn-sm' },
                                { extend: 'excel', className: 'btn-sm' }


                            ],
                            responsive: true,
                            "scrollY": "500px",
                            "scrollCollapse": true,
                            "paging": false
                        });
                    }
                };

                var TableManageButtons = function () {
                    "use strict";
                    return {
                        //main function
                        init: function () {
                            handleDataTableButtons();
                        }
                    };
                }();

                TableManageButtons.init();

                $('#select-all').on('change', function () {

                    if (this.checked) {
                        $(".rowchk").prop('checked', true);
                    }
                    else {
                        $(".rowchk").prop('checked', false);
                    }
                });

                $('#FormRefund').submit(function (e) {
                 var formData = new FormData();
                //formData.append('model', jsonRequest);
                e.preventDefault();
                ////JSON obj
                //formData.append('ProfImg', ProfImg);
                    var formData = new FormData($('#FormRefund')[0]);
                var url = "@Url.Action("SetStatus", "AdmRefund")";

                var boxes = $('.rowchk');
                if (boxes.filter(':checked').length == 0) {
                    $.gritter.add({
                        title: 'Warning !',
                        text: 'Please checked at least 1 row'
                    });
                }
                else {
                    $.ajax({
                    url: url,
                    type: "POST",
                    //cache: false,
                    //traditional: true,
                    //dataType: 'json',
                    dataType: 'json',
                    contentType: false,
                    processData: false,

                    //data: { model: jsonRequest, ProfImg: ProfImg},
                    data: formData,
                    //contentType: "application/json; charset=utf-8",
                    //async: false,
                    beforeSend:
                        function () {
                            //$("#spinner").show();
                        },
                        success: function (data) {



                        $.gritter.add({
                            title: 'Success !',
                            text: 'Success'
                        });

                            setTimeout(function () { window.location.reload(); }, 1500);

                        @*window.location.href = "@Url.Action("", "AdmTalent")";*@

                    },
                    error: function (jqXHR, textStatus, errorMessage) {
                        console.log(errorMessage);
                    }
                });
                }



            });

            $("#ddlPeriod").change(function () {
                var period = $("#ddlPeriod").val();
                var Status = $("#FilterStatus").val();

                window.location.href = "../AdmRefund/SearchData?Status=" + Status;
                  
            });

            $("#FilterStatus").change(function () {
                var period = $("#ddlPeriod").val();
                var Status = $("#FilterStatus").val();

                window.location.href = "../AdmRefund/SearchData?Status=" + Status + "";

            });

            });
        </script>
    }

